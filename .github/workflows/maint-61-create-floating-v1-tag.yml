name: Maint 61 Create Floating v1 Tag

on:
  workflow_dispatch:
  schedule:
    - cron: "30 3 * * *"
  release:
    types:
      - published

permissions:
  contents: write

jobs:
  create-floating-v1-tag:
    name: Create or refresh floating v1 tag
    runs-on: ubuntu-latest
    if: github.event_name == 'workflow_dispatch' || startsWith(github.event.release.tag_name, 'v1.')
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Ensure floating v1 tag points to latest v1.x
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          ALLOW_MISSING_RELEASES: 1
        run: |
          scripts/update-floating-tag.sh v1 v1.
